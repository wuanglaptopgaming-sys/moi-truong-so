<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C·ªông ƒë·ªìng h·ªçc t·∫≠p</title>

<style>
:root{
  --accent:#0072ff; 
  --bg:#f5f8ff; 
  --card:#fff; 
  --text:#222;
  --muted:#6b7280;
}
body{
  font-family: "Segoe UI", sans-serif;
  margin:0; padding:0;
  background: var(--bg);
  color: var(--text);
}

/* Header gi·ªëng Index */
header{
  background: var(--card);
  padding:12px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #dbe3f4;
  position:sticky; top:0; z-index:20;
}
header .brand{display:flex;align-items:center;gap:12px;}
.logo{
  width:40px;height:40px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  background:linear-gradient(135deg,#00c6ff,#0072ff);
  color:white;font-weight:700;
}
header nav a{
  margin-left:14px;font-weight:600;
  text-decoration:none;color:var(--text);
}
header nav a:hover{color:var(--accent);}

/* Form ƒëƒÉng b√†i */
.post-box{
  background: var(--card);
  width:100%; max-width:600px;
  margin:20px auto;
  padding:18px;
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,0.07);
}
.post-box textarea{
  width:100%; border:none; resize:none;
  padding:10px; border-radius:8px;
  background:#f0f4ff;
}
.post-box input[type=file]{display:none;}
.post-box label{
  display:inline-block; margin-top:8px;
  padding:6px 12px; background:var(--accent);
  color:white; border-radius:6px; cursor:pointer;
}
.post-box button{
  margin-top:10px; padding:8px 16px;
  background:var(--accent); color:white;
  border:none; border-radius:8px; cursor:pointer;
}

/* B√†i ƒëƒÉng */
.post{
  background:var(--card);
  max-width:600px;
  margin:14px auto;
  padding:16px;
  border-radius:12px;
  box-shadow:0 1px 6px rgba(0,0,0,0.06);
}
.post-header{
  display:flex;align-items:center;gap:10px;
}
.post-header img{
  width:42px;height:42px;border-radius:50%;object-fit:cover;
}
.post-media img{
  width:100%;border-radius:12px;
  cursor:pointer;
  max-height:260px;object-fit:cover;
  margin-top:10px;
}
.post-time{color:var(--muted);font-size:13px;margin-top:4px;}

.post-actions{
  display:flex;gap:12px;margin-top:8px;
}
.post-actions button{
  background:transparent;border:none;
  color:var(--accent);cursor:pointer;
}

/* B√¨nh lu·∫≠n */
.comment-box{
  margin-top:10px;border-top:1px solid #eee;padding-top:10px;
}
.comment{display:flex;gap:8px;margin-top:6px;}
.comment img{
  width:32px;height:32px;border-radius:50%;object-fit:cover;
}
.comment-text{
  background:#f3f6ff;padding:6px 10px;border-radius:8px;
}
.comment-time{font-size:12px;color:var(--muted);}

/* Ph√≥ng to ·∫£nh */
#imgView{
  position:fixed;inset:0;background:rgba(0,0,0,0.8);
  display:none;align-items:center;justify-content:center;
}
#imgView img{max-width:90%;max-height:90%;border-radius:12px;}


.post-header{
  display:flex;align-items:center;gap:10px;margin-bottom:8px;
}
.avatar{
  width:45px;height:45px;border-radius:50%;object-fit:cover;
}
.avatar-small{
  width:28px;height:28px;border-radius:50%;object-fit:cover;
}
.post-img, .comment-img{
  max-width:100%;
  border-radius:12px;
  margin-top:8px;
  cursor:pointer;
}
.post-img{
  max-height:280px;
  object-fit:cover;
}
.post-actions{
  margin-top:6px;
}
.comment{
  display:flex;gap:8px;margin-top:10px;
}
.comment-content{
  background:#f3f6ff;
  border-radius:10px;
  padding:6px 10px;
  flex:1;
}
.comment-img{
  max-width:150px;
  border-radius:8px;
}
.delete-post, .delete-cmt{
  border:none;background:none;color:red;cursor:pointer;
}
.like-cmt{
  border:none;background:none;cursor:pointer;margin-top:4px;
}


</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo">ED</div>
    <strong>C·ªông ƒë·ªìng h·ªçc t·∫≠p</strong>
  </div>
  <nav>
    <a href="index.html">Trang ch·ªß</a>
  </nav>
</header>

<!-- Form ƒëƒÉng b√†i -->
<div class="post-box">
  <textarea id="postText" placeholder="B·∫°n ƒëang nghƒ© g√¨?"></textarea>
  <label for="postImg">üì∑ Th√™m ·∫£nh</label>
  <input type="file" id="postImg" accept="image/*">
  <button id="postBtn">ƒêƒÉng b√†i</button>
</div>

<!-- Danh s√°ch b√†i ƒëƒÉng -->
<div id="postList"></div>

<!-- Khung ph√≥ng ·∫£nh -->
<div id="imgView"><img><div></div></div>

<script>
// l·∫•y user
function getUsers() { return JSON.parse(localStorage.getItem("users")||"[]"); }
function getAvatar(user){ return user.avatar || "https://i.imgur.com/PHv4T6B.png"; }

// t·∫£i avatar + t√™n
function getCurrentUser(){
  const name = localStorage.getItem("username");
  if(!name) return null;
  return getUsers().find(u => u.username === name);
}

function now(){
  return new Date().toLocaleString("vi-VN",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit"});
}

function getPosts(){ return JSON.parse(localStorage.getItem("posts")||"[]"); }
function savePosts(p){ localStorage.setItem("posts", JSON.stringify(p)); }

// ƒëƒÉng b√†i
document.getElementById("postBtn").onclick = ()=>{
  const user = getCurrentUser();
  if(!user){ alert("B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p."); return; }

  let text = document.getElementById("postText").value.trim();
  let file = document.getElementById("postImg").files[0];
  let img = "";

  if(file){
    let reader = new FileReader();
    reader.onload = e=>{
      img = e.target.result;
      savePost();
    }
    reader.readAsDataURL(file);
  } else savePost();

  function savePost(){
    if(!text && !img) return;
    const posts = getPosts();
    posts.unshift({
      user:user.username,
      avatar:getAvatar(user),
      text,
      img,
      time:now(),
      comments:[]
    });
    savePosts(posts);
    document.getElementById("postText").value="";
    document.getElementById("postImg").value="";
    render();
  }
};

// render b√†i ƒëƒÉng


function render(){
  const posts = getPosts();
  const container = document.getElementById("postList");
  container.innerHTML = "";

  posts.forEach((p,i)=>{
    container.innerHTML += `
    <div class="post">
      <div class="post-header">
        <img class="avatar" src="${p.avatar}">
        <div>
          <b>${p.user}</b>
          <span class="post-time">${p.time}</span>
        </div>
        <button class="delete-post" onclick="deletePost(${i})">üóëÔ∏è</button>
      </div>

      <p>${p.text || ""}</p>
      ${p.img ? `<img class="post-img" src="${p.img}" onclick="viewImg('${p.img}')">` : ""}

      <div class="post-actions">
        <button onclick="toggleLike(${i})">‚ù§Ô∏è ${p.likes || 0}</button>
      </div>

      <div class="comment-box">
        <input placeholder="Vi·∫øt b√¨nh lu·∫≠n..." id="cmt-${i}">
        <button onclick="addComment(${i})">G·ª≠i</button>
        <label style="cursor:pointer;">üì∑<input type="file" accept="image/*" style="display:none" onchange="addCommentImg(${i},this)"></label>
      </div>

      <div class="comments">
        ${p.comments.map((c, ci)=>`
          <div class="comment">
            <img class="avatar-small" src="${c.avatar}">
            <div class="comment-content">
              <b>${c.user}</b> <span class="comment-time">${c.time}</span>
              <div>${c.text || ""}</div>
              ${c.img ? `<img class="comment-img" src="${c.img}" onclick="viewImg('${c.img}')">` : ""}
              <button class="like-cmt" onclick="likeComment(${i},${ci})">üëç ${c.likes || 0}</button>
              <button class="delete-cmt" onclick="deleteComment(${i},${ci})">‚úñ</button>
            </div>
          </div>
        `).join("")}
      </div>
    </div>`;
  });
}



      <p>${p.text || ""}</p>

      ${
        p.img ? `<div class="post-media"><img src="${p.img}" onclick="viewImg('${p.img}')"></div>`:""
      }

      <div class="comment-box">
        <input placeholder="Vi·∫øt b√¨nh lu·∫≠n..." id="cmt-${i}">
        <button onclick="addComment(${i})">G·ª≠i</button>
        <label style="cursor:pointer;">üì∑<input type="file" accept="image/*" style="display:none" onchange="addCommentImg(${i},this)"></label>

        ${p.comments.map(c=>`
          <div class="comment">
            <img src="${c.avatar}">
            <div class="comment-text">
              <b>${c.user}</b><br>${c.text || ""}<br>
              ${c.img ? `<img src="${c.img}" style="width:140px;border-radius:8px;margin-top:4px;">`:""}
              <div class="comment-time">${c.time}</div>
            </div>
          </div>
        `).join("")}
      </div>
    </div>`;
  });
}

function addComment(i){
  const user = getCurrentUser();
  if(!user){ alert("B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p."); return; }
  const posts = getPosts();
  let text = document.getElementById("cmt-"+i).value.trim();
  if(!text) return;
  posts[i].comments.push({user:user.username,avatar:getAvatar(user),text,time:now()});
  savePosts(posts); render();
}

function addCommentImg(i,input){
  const user = getCurrentUser();
  if(!user){ alert("B·∫°n ph·∫£i ƒëƒÉng nh·∫≠p."); return; }

  const file = input.files[0];
  let reader = new FileReader();
  reader.onload = e=>{
    const posts = getPosts();
    posts[i].comments.push({user:user.username,avatar:getAvatar(user),img:e.target.result,time:now()});
    savePosts(posts); render();
  }
  reader.readAsDataURL(file);
}

// xem ·∫£nh l·ªõn
function viewImg(src){
  const box = document.getElementById("imgView");
  box.style.display="flex";
  box.querySelector("img").src = src;
}
document.getElementById("imgView").onclick = ()=> document.getElementById("imgView").style.display="none";


function deletePost(i){
  const user = getCurrentUser();
  const posts = getPosts();
  if(!user || posts[i].user !== user.username) return alert("B·∫°n ch·ªâ c√≥ th·ªÉ x√≥a b√†i c·ªßa ch√≠nh m√¨nh.");
  posts.splice(i,1);
  savePosts(posts);
  render();
}

function deleteComment(pi, ci){
  const user = getCurrentUser();
  const posts = getPosts();
  if(!user || posts[pi].comments[ci].user !== user.username) return alert("B·∫°n ch·ªâ c√≥ th·ªÉ x√≥a b√¨nh lu·∫≠n c·ªßa m√¨nh.");
  posts[pi].comments.splice(ci,1);
  savePosts(posts);
  render();
}

function toggleLike(i){
  const posts = getPosts();
  posts[i].likes = (posts[i].likes || 0) + 1;
  savePosts(posts);
  render();
}

function likeComment(pi,ci){
  const posts = getPosts();
  posts[pi].comments[ci].likes = (posts[pi].comments[ci].likes || 0) + 1;
  savePosts(posts);
  render();
}

function addCommentImg(i,input){
  const user = getCurrentUser();
  if(!user) return alert("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p.");

  const file = input.files[0];
  const reader = new FileReader();
  reader.onload = function(e){
    const posts = getPosts();
    posts[i].comments.push({
      user:user.username,
      avatar:user.avatar,
      img:e.target.result,
      text:"",
      time:new Date().toLocaleString(),
      likes:0
    });
    savePosts(posts);
    render();
  }
  reader.readAsDataURL(file);
}


render();
</script>

</body>
</html>
