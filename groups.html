<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Nhóm học tập</title>
<style>
:root{--bg:#f8fafc;--card:#fff;--primary:#2563eb;--muted:#6b7280}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--bg);color:#111;line-height:1.5}
header{background:linear-gradient(90deg,#3b82f6,#2563eb);color:#fff;padding:30px 16px;text-align:center}
h1{font-size:28px;margin-bottom:6px}
p.lead{font-size:15px;opacity:0.9}

.container{max-width:1100px;margin:30px auto;padding:0 16px}
.section-title{font-size:20px;margin-bottom:14px;color:#111;border-left:4px solid var(--primary);padding-left:8px}

.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:16px}
.card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.06);display:flex;flex-direction:column;justify-content:space-between}
.card h3{font-size:16px;margin-bottom:6px}
.card p{font-size:14px;color:var(--muted);margin-bottom:8px}
.btn{background:var(--primary);color:#fff;border:none;border-radius:10px;padding:10px;font-size:14px;cursor:pointer;transition:.2s}
.btn:hover{opacity:.9}
.btn.leave{background:#ef4444}

footer{text-align:center;color:var(--muted);margin:40px 0 20px;font-size:14px}

.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:50}
.modal{background:var(--card);padding:20px;border-radius:12px;max-width:400px;width:90%}
label{display:block;margin:8px 0 4px;color:var(--muted)}
input,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #e5e7eb}
textarea{min-height:80px}
</style>
</head>
<body>

<header>
  <h1>Nhóm học tập</h1>
  <p class="lead">Nơi bạn tạo, tham gia và chia sẻ cùng các nhóm yêu thích</p>
</header>

<main class="container">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
    <h2 class="section-title">Gợi ý nhóm nổi bật</h2>
    <button id="createBtn" class="btn">+ Tạo nhóm</button>
  </div>

  <div class="grid" id="suggestedGroups"></div>

  <section style="margin-top:40px">
    <h2 class="section-title">Nhóm bạn đã tham gia</h2>
    <div class="grid" id="joinedGroups">
      <p style="color:var(--muted)">Bạn chưa tham gia nhóm nào. Hãy chọn nhóm ở trên để bắt đầu!</p>
    </div>
  </section>
</main>

<footer>
  <p>© 2025 Môi Trường Số Học Tập — Kết nối, chia sẻ, học hỏi.</p>
</footer>

<!-- Modal tạo nhóm -->
<div id="modal" class="modal-backdrop">
  <div class="modal">
    <h3>Tạo nhóm mới</h3>
    <label for="groupName">Tên nhóm</label>
    <input id="groupName" type="text" placeholder="Nhập tên nhóm..." />
    <label for="groupDesc">Mô tả</label>
    <textarea id="groupDesc" placeholder="Nhập mô tả nhóm..."></textarea>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="cancelCreate" class="btn leave">Hủy</button>
      <button id="confirmCreate" class="btn">Tạo</button>
    </div>
  </div>
</div>

<script>
/* ========= Storage Helpers ========= */
function getUser(){ return localStorage.getItem('username'); }
function getGroups(){ return JSON.parse(localStorage.getItem('groups') || '[]'); }
function saveGroups(data){ localStorage.setItem('groups', JSON.stringify(data)); }
function getJoined(){ return JSON.parse(localStorage.getItem('joinedGroups') || '[]'); }
function saveJoined(data){ localStorage.setItem('joinedGroups', JSON.stringify(data)); }

/* ========= Khởi tạo dữ liệu mẫu ========= */
const defaultGroups = [
  { name:'Sách & Văn Học', desc:'Trao đổi cảm nhận sách, văn học Việt Nam và thế giới.' },
  { name:'Công Nghệ & Lập Trình', desc:'Cộng đồng chia sẻ kiến thức, học tập và kỹ năng công nghệ.' },
  { name:'Sống Khỏe Mỗi Ngày', desc:'Chia sẻ bí quyết dinh dưỡng và rèn luyện sức khỏe.' }
];
if(!localStorage.getItem('groups')) saveGroups(defaultGroups);

/* ========= Render giao diện ========= */
const suggestedContainer = document.getElementById('suggestedGroups');
const joinedContainer = document.getElementById('joinedGroups');

function renderGroups(){
  const groups = getGroups();
  const joined = getJoined();
  suggestedContainer.innerHTML = '';
  groups.forEach(g=>{
    const joinedAlready = joined.some(j=>j.name===g.name);
    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <div><h3>${g.name}</h3><p>${g.desc}</p></div>
      <button class='btn' ${joinedAlready?'disabled':''}>${joinedAlready?'Đã tham gia':'Tham gia'}</button>`;
    const btn = card.querySelector('.btn');
    btn.addEventListener('click',()=>joinGroup(g.name,g.desc,btn));
    suggestedContainer.appendChild(card);
  });

  // joined list
  if(!joined.length){
    joinedContainer.innerHTML = `<p style="color:var(--muted)">Bạn chưa tham gia nhóm nào. Hãy chọn nhóm ở trên để bắt đầu!</p>`;
  } else {
    joinedContainer.innerHTML='';
    joined.forEach(j=>{
      const card=document.createElement('div');
      card.className='card';
      card.innerHTML=`<div><h3>${j.name}</h3><p>${j.desc}</p></div><button class='btn leave'>Rời nhóm</button>`;
      card.querySelector('.leave').addEventListener('click',()=>leaveGroup(j.name));
      joinedContainer.appendChild(card);
    });
  }
}

/* ========= Tham gia / Rời nhóm ========= */
function joinGroup(name,desc,btn){
  const user=getUser();
  if(!user){ alert('Bạn cần đăng nhập để tham gia nhóm!'); return; }
  const joined=getJoined();
  if(joined.some(g=>g.name===name)) return;
  joined.push({name,desc});
  saveJoined(joined);
  btn.textContent='Đã tham gia';
  btn.disabled=true;
  renderGroups();
}

function leaveGroup(name){
  let joined=getJoined();
  joined = joined.filter(g=>g.name!==name);
  saveJoined(joined);
  renderGroups();
}

/* ========= Modal tạo nhóm ========= */
const modal=document.getElementById('modal');
document.getElementById('createBtn').onclick=()=>{
  const user=getUser();
  if(!user){ alert('Bạn cần đăng nhập để tạo nhóm!'); return; }
  modal.style.display='flex';
};
document.getElementById('cancelCreate').onclick=()=>modal.style.display='none';
document.getElementById('confirmCreate').onclick=()=>{
  const name=document.getElementById('groupName').value.trim();
  const desc=document.getElementById('groupDesc').value.trim() || 'Không có mô tả.';
  if(!name){alert('Vui lòng nhập tên nhóm');return;}
  const groups=getGroups();
  if(groups.some(g=>g.name===name)){alert('Tên nhóm đã tồn tại!');return;}
  groups.unshift({name,desc});
  saveGroups(groups);
  modal.style.display='none';
  document.getElementById('groupName').value='';
  document.getElementById('groupDesc').value='';
  renderGroups();
};

/* ========= Init ========= */
renderGroups();
</script>
</body>
</html>
